<%@ page buffer="8kb" autoFlush="true" %>
<%@ page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8" %>
<%@ taglib prefix="zm" uri="com.zimbra.zm" %>
<%@ taglib prefix="app" uri="com.zimbra.htmlclient" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<fmt:setBundle basename="/msgs/ZhMsg" scope="session"/>

<app:handleError>
    <zm:getMailbox var="mailbox"/>
    <zm:getMessage var="msg" id="${param.id}" markread="true" neuterimages="${empty param.xim}"/>
</app:handleError>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<app:head title="${msg.subject}" mailbox="${mailbox}"/>
<body>
    <zm:currentResultUrl var="currentUrl" value="" action="view" context="${null}"/>
    <table width=100% cellpadding="0" cellspacing="0">
        <tr>
            <td class='ZhAppContent'>
                <c:set var="extImageUrl" value=""/>
                <c:if test="${empty param.xim}">
                    <zm:currentResultUrl var="extImageUrl" value="message" action="view" context="${null}" xim="1" id="${param.id}"/>
                </c:if>
                <zm:currentResultUrl var="composeUrl" value="search" context="${null}"
                                     action="compose" paction="view" id="${msg.id}"/>
                <app:displayMessage mailbox="${mailbox}" hideops="true" message="${msg}"externalImageUrl="${extImageUrl}" showconvlink="true" composeUrl="${composeUrl}"/>
            </td>
        </tr>
    </table>
</body>
</html>
