<html>
<title>Theme Color Picker</title>
<style type='text/css'>
* {	font-family:Verdana; font-size:10px;	}

body {
	background-color:#e8dcc1;
}

.title {
	font-size:24px;
	font-weight:bold;
}

.instructions {
	font-style:italic;
}

.colorChip	{
	width:5; height:20px;
	border:1px solid black;
	border-right-width:0px;
	cursor:pointer;
}

.baseColor {
	width:30px;
}

#display td {
	font-size:9px;
	color:#666666;
}

#display div {
	font-size:9px;
	color:black;
}


#clipboard {
	width:100%; height:100%;
	font-family:monaco,monospace;
	font-size:10px;
}

.label {
	font-weight:bold;
	width:80;
	text-align:right;
}

.field {
	width:100;
}

input {
	width:80;
}

.focused {
	background-color:yellow;
}

#picker {
	Xposition:absolute;
	border:2px solid black;
	background-color:white;
	Xright:50; top:0;
}

#pickerGrid {}
#huePicker{}

.pickerCell {
	width:12; height:12;
	cursor:pointer;
}

.hueCell {
	width:20; height:2; font-size:1px;
	cursor:pointer;
}

</style>
<script language=JavaScript>
/*****
 *	Generic color math routines
 *****/
function darken(hex, amount) {
	var rgb = hex2rgb(hex);
	var darker = {};
	
	darker.r = Math.round(rgb.r * ((100-amount)/100));
	darker.g = Math.round(rgb.g * ((100-amount)/100));
	darker.b = Math.round(rgb.b * ((100-amount)/100));

	return rgb2hex(darker);
}

function lighten(hex, amount) {
	rgb = hex2rgb(hex);
	var lighter = {};
	
	lighter.r = Math.round(rgb.r + (255 - rgb.r) * (amount/100));
	lighter.g = Math.round(rgb.g + (255 - rgb.g) * (amount/100));
	lighter.b = Math.round(rgb.b + (255 - rgb.b) * (amount/100));

	return rgb2hex(lighter);
}


hexdig='0123456789abcdef';
function Dec2Hex(d) {
	return hexdig.charAt((d-(d%16))/16)+hexdig.charAt(d%16);
}
function Hex2Dec(h) {
	h=h.toLowerCase();
	d=0;
	for (i=0;i<h.length;i++) {
		d=d*16;
		d+=hexdig.indexOf(h.charAt(i));
	}
	return d;
}

function rgb2Hex(r,g,b) {
	return Dec2Hex(r)+Dec2Hex(g)+Dec2Hex(b);
}

// rgb2hsv and hsv2rgb are based on Color Match Remix [http://color.twysted.net/]
// which is based on or copied from ColorMatch 5K [http://colormatch.dk/]
function hsv2rgb(hsv) {
	var rgb=new Object();
	if (hsv.saturation==0) {
		rgb.r=rgb.g=rgb.b=Math.round(hsv.value*2.55);
	} else {
		hsv.hue/=60;
		hsv.saturation/=100;
		hsv.value/=100;
		i=Math.floor(hsv.hue);
		f=hsv.hue-i;
		p=hsv.value*(1-hsv.saturation);
		q=hsv.value*(1-hsv.saturation*f);
		t=hsv.value*(1-hsv.saturation*(1-f));
		switch(i) {
		case 0: rgb.r=hsv.value; rgb.g=t; rgb.b=p; break;
		case 1: rgb.r=q; rgb.g=hsv.value; rgb.b=p; break;
		case 2: rgb.r=p; rgb.g=hsv.value; rgb.b=t; break;
		case 3: rgb.r=p; rgb.g=q; rgb.b=hsv.value; break;
		case 4: rgb.r=t; rgb.g=p; rgb.b=hsv.value; break;
		default: rgb.r=hsv.value; rgb.g=p; rgb.b=q;
		}
		rgb.r=Math.round(rgb.r*255);
		rgb.g=Math.round(rgb.g*255);
		rgb.b=Math.round(rgb.b*255);
	}
	return rgb;
}

function min3(a,b,c) { return (a<b)?((a<c)?a:c):((b<c)?b:c); }
function max3(a,b,c) { return (a>b)?((a>c)?a:c):((b>c)?b:c); }

function rgb2hsv(rgb) {
	hsv = new Object();
	max=max3(rgb.r,rgb.g,rgb.b);
	dif=max-min3(rgb.r,rgb.g,rgb.b);
	hsv.saturation=(max==0.0)?0:(100*dif/max);
	if (hsv.saturation==0) hsv.hue=0;
 	else if (rgb.r==max) hsv.hue=60.0*(rgb.g-rgb.b)/dif;
	else if (rgb.g==max) hsv.hue=120.0+60.0*(rgb.b-rgb.r)/dif;
	else if (rgb.b==max) hsv.hue=240.0+60.0*(rgb.r-rgb.g)/dif;
	if (hsv.hue<0.0) hsv.hue+=360.0;
	hsv.value=Math.round(max*100/255);
	hsv.hue=Math.round(hsv.hue);
	hsv.saturation=Math.round(hsv.saturation);
	return hsv;
}

function HueShift(h,s) {
	h+=s;
	while (h>=360.0) h-=360.0;
	while (h<0.0) h+=360.0;
	return h;
}


function hex2rgb(hex) {
	var r = Hex2Dec(hex.charAt(0) + hex.charAt(1));
	var g = Hex2Dec(hex.charAt(2) + hex.charAt(3));
	var b = Hex2Dec(hex.charAt(4) + hex.charAt(5));
	return {r: r, g: g, b:b};
}

function rgb2hex(rgb) {
	return Dec2Hex(rgb.r) + Dec2Hex(rgb.g) + Dec2Hex(rgb.b);
}

function hex2hsv(hex) {
	return rgb2hsv(hex2rgb(hex));
}

function hsv2hex(hsv) {
	return rgb2hex(hsv2rgb(hsv));
}

function $(id) {
	return document.getElementById(id);
}
</script>

<script language='javascript'>
/*****
 *	App-specific stuff
 *****/

function initPicker() {
	var picker = document.getElementById("picker");
	picker.innerHTML = 	"<table><tr><td><div id='pickerGrid'><\/div><\/td><td><div id='huePicker'><\/div><\/td><\/tr><\/table>";

	drawHues(drawHues);	
	focusInColorField(1);
}


function pickColor(color) {
	setFocusColor(color);
	drawCurrentColors();
}

function pickHue(hue) {
	drawShades(hue);

	var hsv = hex2hsv(getFocusColor());
	hsv.hue = hue;
	setFocusColor(hsv2hex(hsv));
}

var currentColorField = 'colorRGB1';
function focusInColorField(num) {
	var id = "colorRGB"+num;
	setCurrentFocus(id);
	var hex = $(id).value;
	var hsv = hex2hsv(hex);
	pickHue(hsv.hue);
}

function setCurrentFocus(id) {
	currentColorField = id;
	hilightFocusedField();
}

function hilightFocusedField() {
	$('colorRGB1').className = (currentColorField == 'colorRGB1' ? "focused" : "");
	$('colorRGB2').className = (currentColorField == 'colorRGB2' ? "focused" : "");
}

function getFocusColor() {
	return safeColor($(currentColorField).value);
}
function safeColor(color) {
	if (color.charAt(0) == "#") color = color.substr(1);
	return color;
}

function setFocusColor(hex) {
	$(currentColorField).value = hex;
	drawCurrentColors();
}

function getColorName(baseName, modifier) {
	if (modifier == null) return "_" + baseName + "_";
	return "_" + baseName + modifier + "_";
}

function getJSRep(name, value) {
	return "\t"+name + "\t\t=\t#" + value;
}


function drawCurrentColors() {
	var clipboard = document.getElementById('clipboard');
	clipboard.value = "##########################################################################\n"+
					  "#                               Skin Colors                              #\n"+
					  "#------------------------------------------------------------------------#\n#\n";
	drawCurrentColor(1, "BaseColor", "#### Base color and variants ####");
	drawCurrentColor(2, "SelColor", "#### Selection color and variants ####");	
	clipboard.value += "#\n#========================================================================#\n"
	hilightFocusedField();
}

function drawCurrentColor(num, name, jsHeader) {
	var baseColor = safeColor($('colorRGB'+num).value);

	var darkJS = [jsHeader,getJSRep(getColorName(name)+"\t", baseColor)];
	var lightJS = [];

	var html = 
		["<table cellspacing=0 cellpadding=0 style='border-right:1px solid black' onclick='focusInColorField("+num+")'>",
			"<tr>",
		];

	for (var i = 95; i >= 5; i-=5) {
		var darkColor  = darken(baseColor, i);
		var darkName = getColorName(name, "D"+ i);

		html.push([
				"<td><div class='colorChip' style='background-color:", darkColor, "'><\/div><\/td>",
			].join(""));

		darkJS.push(getJSRep(darkName, darkColor));
	}

	html.push([
				"<td><div class='colorChip baseColor' style='background-color:", baseColor, "'><\/div><\/td>",
			].join(""));

	for (var i = 5; i <= 95; i+=5) {
		var lightColor = lighten(baseColor, i);
		var lightName = getColorName(name, "L"+ i);

		html.push([
				"<td><div class='colorChip' style='background-color:", lightColor, "'><\/div><\/td>",
			].join(""));

		lightJS.push(getJSRep(lightName, lightColor));
	}
	html.push("<\/tr><\/table>");
	
	var display = document.getElementById('display'+num);
	display.innerHTML = html.join("\n");

	var clipboard = document.getElementById('clipboard');
	clipboard.value += darkJS.join("\n") + "\n" + lightJS.join("\n") + "\n";
}

function drawShades(hue) {
	var hsv = {};

	var html = ["<table cellspacing=0 cellpadding=0>"];

	for (var v = 100; v >= 0; v -=5) {
		html.push("<tr>");
		for (var s = 0; s <= 100; s+= 5) {
			hsv.hue = hue;
			hsv.saturation = s;
			hsv.value = v;
			var color = rgb2hex(hsv2rgb(hsv));
			html.push("<td><div class=pickerCell onclick='pickColor(\"", color, "\")' style='background-color:", color, "'><\/div><\/td>");
		}
		html.push("<\/tr>");
	}
	html.push("<\/table>");
	
	var picker = document.getElementById("pickerGrid");
	picker.innerHTML = html.join("");
}


function drawHues() {
	var html = ["<table cellspacing=0 cellpadding=0 height=100%>"];

	var hsv = {};
	
	for (var hue = 0; hue <= 360; hue += 3) {
		hsv.hue = hue;
		hsv.saturation = 100;
		hsv.value = 100;
		var color = rgb2hex(hsv2rgb(hsv));
		html.push("<\/tr><td><div class=hueCell onclick='pickHue(\"", hue, "\")' style='background-color:", color, "'><\/div><\/td><\/tr>");
	}
	html.push("<\/table>");
	
	var huePicker = document.getElementById("huePicker");
	huePicker.innerHTML = html.join("");
}

</script>
<body onload='initPicker();drawCurrentColors();'>
<table width=100% height=100% border=0>
	<tr><td colspan=4 class=title colspan=2>Theme Color Picker</td>
		<td rowspan=5>
			<div id=picker></div>
		</td>
	</tr>
	<tr><td colspan=3 class='instructions'>
			For information about how to use this file to create a theme,
			please see the <a href=http://wiki.zimbra.com/index.php?title=Themes>Zimbra Wiki</a>.
			<br><br>
			<b>Note: this file works best in <a href=http://www.mozilla.com/firefox/ target=_blank>Mozilla FireFox</a></b><br><br>
			Each Zimbra Theme is composed of two families of colors:
			<ul>
				<li>the "BaseColor" used for the main body of the application, and</li>
				<li>the "SelColor" used to indicate selection, (eg: the background color of the selected message).</li>
			</ul>
			To pick these colors for your theme:<br><br>
			
			<b>1)</b> Click in the appropriate "RGB Value" box below and either paste a color value
			or pick one from the gradient to the right.
		</td>
	</tr>

	<tr>
		<td class=label>BaseColor:</td>
		<td class=field><input class=rgbField id='colorRGB1' value='e8dcc1'  onfocus='focusInColorField(1)' onblur='drawCurrentColors()'></td>
		<td><div id='display1'></div></td>
	</tr>

	<tr>
		<td class=label>SelColor:</td>
		<td class=field><input class=rgbField id='colorRGB2' value='C7E6F6'  onfocus='focusInColorField(2)' onblur='drawCurrentColors()'></td>
		<td><div id='display2'></div></td>
	</tr>

	<tr><td colspan=3 class='instructions'>
			<b>2)</b> Then copy and paste the text below into your <b>mytheme_subs.txt</b> file.<br><br>
		</td>
	</tr>

	<tr><td colspan=6 height=100%><textarea id='clipboard' onfocus='this.select()'></textarea></td></tr>
</table>

</body>
</html>