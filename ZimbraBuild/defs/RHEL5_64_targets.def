$(BUILD_ROOT)/zimbracore.spec:
	cp $(PACKAGE_CONF_DIR)/Spec/Scripts/zimbracore.pre $(BUILD_ROOT)
	cp $(PACKAGE_CONF_DIR)/Spec/Scripts/zimbracore.post $(BUILD_ROOT)
	cat $(PACKAGE_CONF_DIR)/Spec/zimbracore.spec | \
	sed -e 's/@@VERSION@@/$(VERSION_TAG)/' \
	-e 's/@@RELEASE@@/$(RELEASE)/' \
	-e 's/@@COMPAT_LIBSTDC@@/$(COMPAT_LIBSTDC)/' \
	-e 's/^Copyright:/$(RPMCOPYRIGHTSTR):/' \
	-e '/^%pre$$/ r zimbracore.pre' \
	-e '/^%post$$/ r zimbracore.post' > $(BUILD_ROOT)/zimbracore.spec
	rm -f zimbracore.pre
	rm -f zimbracore.post
	(cd $(CORE_DEST_ROOT); find opt -type f -o -type l -maxdepth 2 \
		| sed -e 's|^|%attr(-, zimbra, zimbra) /|' >> \
		$(BUILD_ROOT)/zimbracore.spec )
	echo "%attr(755, root, root) /opt/zimbra/bin" >> \
		$(BUILD_ROOT)/zimbracore.spec
	echo "%attr(755, zimbra, zimbra) /opt/zimbra/doc" >> \
		$(BUILD_ROOT)/zimbracore.spec
	echo "%attr(755, root, root) /opt/zimbra/contrib" >> \
		$(BUILD_ROOT)/zimbracore.spec
	echo "%attr(755, root, root) /opt/zimbra/libexec" >> \
		$(BUILD_ROOT)/zimbracore.spec
	echo "%attr(755, root, root) /opt/zimbra/logger" >> \
		$(BUILD_ROOT)/zimbracore.spec
	echo "%attr(-, zimbra, zimbra) /opt/zimbra/conf" >> \
		$(BUILD_ROOT)/zimbracore.spec
	echo "%attr(-, zimbra, zimbra) /opt/zimbra/db" >> \
		$(BUILD_ROOT)/zimbracore.spec
	echo "%attr(-, root, root) /opt/zimbra/jdk$(JAVA_VERSION_32)_i386" >> \
		$(BUILD_ROOT)/zimbracore.spec
	echo "%attr(-, root, root) /opt/zimbra/jdk$(JAVA_VERSION)" >> \
		$(BUILD_ROOT)/zimbracore.spec
	echo "%attr(-, root, root) /opt/zimbra/lib" >> \
		$(BUILD_ROOT)/zimbracore.spec
	echo "%attr(-, zimbra, zimbra) /opt/zimbra/zimbramon" >> \
		$(BUILD_ROOT)/zimbracore.spec
	echo "%attr(-, zimbra, zimbra) /opt/zimbra/sleepycat-$(BDB_VERSION)" >> \
		$(BUILD_ROOT)/zimbracore.spec
	echo "%attr(-, root, zimbra) /opt/zimbra/$(SASL_DIR)-$(SASL_VERSION)" >> \
		$(BUILD_ROOT)/zimbracore.spec
